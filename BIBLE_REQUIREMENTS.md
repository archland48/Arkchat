# 聖經查詢核心需求文檔

## 明確的主要需求

### 1. 回答內容必須包含的元素

當回答聖經問題時，回答的內容**必須包含**以下所有元素：

#### ✅ 1. 原文解釋 (Original Language Explanation)
- 解釋關鍵字從希伯來文/希臘文原文
- 包含 Strong's Number（如果上下文提供）
- 解釋語法結構和詞性分析
- 說明原文意思如何增強理解
- **數據來源**: FHL API `qp.php` (字彙分析)

#### ✅ 2. 經文註釋 (Commentary) - 必須註明出處
- **必須使用**上下文中的註釋數據
- **必須明確標註出處**，例如：
  - "根據CBOL註釋..."
  - "根據[註釋書名稱]..."
  - "According to [Commentary Name]..."
- 如果有多個註釋觀點，都要包含
- **數據來源**: FHL API `sc.php` (註釋查詢)

#### ✅ 3. 經文交叉引用 (Cross References)
- 列出 5-10 個相關經文，引用相似主題、概念或字詞
- 說明經文如何連接到聖經其他部分
- 包含舊約和新約的連接（如相關）
- 格式：`相關經文：約翰一書 4:9-10, 羅馬書 5:8, 以弗所書 2:4-5...`
- 簡要解釋每個引用與當前經文的關係
- **數據來源**: FHL API `search.php` (通過關鍵字搜索相關經文)

#### ✅ 4. 歷史背景 (Historical Background)
- 解釋寫作時的歷史和文化背景
- 描述作者、受眾和時代背景
- 包含相關歷史事件、習俗或社會背景
- 說明背景如何影響經文的意思

#### ✅ 5. 反思提示 (Reflection Questions)
- 提供 2-3 個深入的反思問題
- 幫助讀者將經文應用到生活中
- 鼓勵靈性成長和實踐應用
- 問題應該具體且可操作

---

### 2. 優先調用 FHL Bible API

**核心原則**: 確保任何查詢關於聖經或信仰的問題及字詞，都**優先調用 fhl-bible API 裡的內容來回答**。

#### 數據使用優先級

1. **第一優先**: 使用 FHL Bible API 提供的數據
   - 經文內容
   - 註釋（必須註明出處）
   - 原文分析（希臘文/希伯來文）
   - 交叉引用經文
   - 主題查經資料（Torrey & Naves）

2. **第二優先**: 如果 API 數據不足，補充使用 AI 知識庫

3. **必須標註**: 明確區分哪些內容來自 FHL API，哪些來自知識庫

---

## 實現機制

### 1. 查詢檢測優先級

系統會檢測以下類型的查詢：

#### ✅ 自動檢測為 Bible 查詢的情況：

1. **經文引用**
   - `約翰福音 3:16`
   - `John 3:16`
   - `創世記 1:1`

2. **章節查詢**
   - `約翰福音 3`
   - `創世記 1`

3. **關鍵字搜索**
   - `愛`、`信心`、`禱告`、`福音` 等主題關鍵字
   - `如何禱告`、`什麼是愛` 等問題模式
   - `聖經關於...`、`bible says about...` 等搜索模式

4. **Bible Mode 開啟時**
   - 所有查詢都視為 Bible 查詢
   - 即使未檢測到 Bible 關鍵字，也會調用 FHL API

### 2. API 調用策略

#### 經文查詢 (verse)
```typescript
1. getBibleVerse() - 獲取經文（包含 Strong's Number）
2. getCommentary() - 獲取註釋（並行）
3. getWordAnalysis() - 獲取原文分析（並行）
4. searchBible() - 通過關鍵字搜索交叉引用經文
```

#### 章節查詢 (chapter)
```typescript
1. getBibleChapter() - 獲取整章經文
```

#### 搜索查詢 (search)
```typescript
1. searchBible() - 搜索相關經文（15 條）
2. getTopicStudy() - 獲取主題查經資料（Torrey & Naves）
3. searchCommentary() - 搜索註釋（5 條）
```

### 3. 系統提示詞要求

系統提示詞明確要求：

1. **優先使用 FHL Bible API 數據**
2. **必須包含所有 5 個元素**
3. **必須註明註釋出處**
4. **必須使用交叉引用經文**
5. **必須提供歷史背景和反思問題**

---

## 數據流程

```
用戶查詢
  ↓
detectBibleQuery() - 檢測是否為 Bible 查詢
  ↓
根據查詢類型調用 FHL API:
  ├─ 經文查詢 → getBibleVerse + getCommentary + getWordAnalysis + searchBible
  ├─ 章節查詢 → getBibleChapter
  └─ 搜索查詢 → searchBible + getTopicStudy + searchCommentary
  ↓
格式化數據為上下文
  ↓
添加到系統提示詞
  ↓
AI 生成回答（必須包含所有 5 個元素）
```

---

## 驗證檢查清單

### ✅ 回答必須包含：

- [ ] **原文解釋** - 包含希臘文/希伯來文分析
- [ ] **經文註釋** - 明確標註出處（如：根據CBOL註釋...）
- [ ] **交叉引用** - 5-10 個相關經文，格式正確
- [ ] **歷史背景** - 作者、受眾、時代背景
- [ ] **反思提示** - 2-3 個具體可操作的問題

### ✅ 數據來源優先級：

- [ ] **優先使用** FHL API 數據
- [ ] **明確標註** 註釋出處
- [ ] **區分** API 數據和知識庫數據

---

## 示例

### 查詢：`約翰福音 3:16`

**系統會自動**：
1. ✅ 獲取經文內容（包含 Strong's Number）
2. ✅ 獲取註釋（多種註釋書）
3. ✅ 獲取原文分析（希臘文字彙）
4. ✅ 搜索交叉引用經文（通過關鍵字）
5. ✅ AI 生成歷史背景和反思問題

**回答格式**：
```markdown
## 原文解釋
關鍵字：ἠγάπησεν (agapēsen) - Strong's G25
...

## 經文註釋
【CBOL註釋】約翰福音 3:16
...

## 交叉引用
相關經文：約翰一書 4:9-10, 羅馬書 5:8...
...

## 歷史背景
...

## 反思提示
...
```

---

## 總結

✅ **核心需求已實現**：
1. 回答必須包含所有 5 個元素
2. 優先調用 FHL Bible API
3. 必須註明註釋出處
4. 確保所有聖經/信仰查詢都被檢測和處理
